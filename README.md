# Qualcomm® QRB2210 Open Kits StyleTransfer-demo Developer documentation

## Introduce

The project builds on the QRB2210 development kit system source code and runs on the QRB2210 development board, making full use of the diverse and powerful connection and computing power of the development kit. HostAPD and UDHCPD tools were used to enable AP WIFI, GStreamer and ZLMediaKit were used to complete the RTSP streaming media function, and TFLITE was used to complete the inference of Artistic style transfer algorithm.

I wanted to change my video style while I was recording video and provide relatively stable video streaming output. RB1 can just provide the corresponding SDK to help me quickly complete the development of similar smart cameras.

**How does it work?**
a.Quickly build AP WIFI through command line tools.
b.Using MediaServer tool and start up the push stream server.
c.Run gst_selfy_test to complete camera data acquisition, selfy segment algorithm inference, and appsrc push to the local port of device.
d.The MediaServer stream server generates the RTSP stream.
e.The mobile connects to QRB2210 AP wifi and plays RTSP streams  for show depth estimation result by EasyPlayer.

Qualcomm® QRB2210 SoC Open Kits

<img src="./res/RB1.png" width = "30%" height = "30%" div align=centor />

## Materials and Tools used for the project

1. Hardware materials

Except for the Open Kits,The following hardware materials are also needed:

* Type-C usb line

using the usb line to develop on Qualcomm® QRB2210 SoC Open Kits.

<img src="./res/usb.png" width = "30%" height = "30%" div align=centor />

* Charger

Direct power supply for Qualcomm® QRB2210 SoC Open Kits.

<img src="./res/charger.jpg" width = "30%" height = "30%" div align=centor />

* Camera Module
Low power camera module

<img src="./res/camera.png" width = "30%" height = "30%" div align=centor />

## Environment configuration

This section mainly describes the source and configuration of some open source projects or third-party tools needed in the development process.

### Gstreamer
[Gstreamer](https://www.yoctoproject.org) <br>
GStreamer is a library for constructing graphs of media-handling components. The applications it supports range from simple Ogg/Vorbis playback, audio/video streaming to complex audio (mixing) and video (non-linear editing) processing.

### ZLMediaServer
ZLMediaServer is a high-performance operational level streaming media service framework based on C++11.

url: https://github.com/ZLMediaKit/ZLMediaKit

If you want to compile the project in source code, you can clone the entire project and modify zlmediakit_0.1.bb provided by the project to compile it using yocto.We also provide binary executables "MediaServer" generated by compilation in the bin directory.

### EasyPlayer APP
An free, elegant, simple, fast RTSP/RTMP/HLS/HTTP Player.EasyPlayer support RTSP(RTP over TCP/UDP)version& RTMP version & Pro version，cover all kinds of streaming media！

url: http://app.tsingsee.com/EasyRTSPlayer

### Opencv
OpenCV is a cross-platform computer vision and machine learning software library distributed under the Apache2.0 license (open source).
url: https://opencv.org/

### Tensorflow
TensorFlow is an end-to-end open source machine learning platform.
url: https://www.tensorflow.org/

## Compile
No special compilation method is required. After configuring the RB1 special SDK, the product can be generated directly by Cmake compilation.

## Configure and Usage
Start the RB1 and connection RB1 to host by Type-c usb.
### 1. Configure
In the conf directory, a json configuration file is provided. This configuration file is relatively simple. It mainly configures the gstreamer camera pipeline, gstreamer udpsink push pipeline, and tflite yolov5 traffic sign recognition model are mainly configured.

### 2. Usage
The executable files in the bin directory do not require additional command line parameters. The parameters used by the program are configured by the json file, so you only need to put the configuration file in the same directory to execute the program.

```
adb push ./bin/gst_style_test /data/selfie
adb push ./models/style/magenta_arbitrary-image-stylization-v1-256_fp16_prediction_1.tflite  /data/selfie
adb push ./models/style/magenta_arbitrary-image-stylization-v1-256_fp16_transfer_1.tflite /data/selfie
adb push ./sh/ap.sh /data/
adb shell
cd data
sh ap.sh
MediaServer -d &
cd ./style
./gst_style_test
```

Connect your phone to the hotspot and use EasyPlayer APP to access the rtsp address:
rtsp://192.168.3.1:554/live/test


**result show**</br>

<img src="./res/result.png" width = "30%" height = "30%" div align=left />